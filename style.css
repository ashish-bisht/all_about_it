@import url('https://fonts.googleapis.com/css2?family=Syne:wght@700;800&family=JetBrains+Mono:wght@300;400;500;700&display=swap');

/* ================================================
   Learn - Professional Dark Theme
   Clean, minimal, modern design system
   ================================================ */

:root {
    /* Surface Colors */
    --bg-dark: #0b0f1a;
    --bg-surface: #111827;
    --bg-card: #1a1f2e;
    --bg-elevated: #222838;
    --bg-glass: rgba(17, 24, 39, 0.85);

    /* Text (tuned for better contrast) */
    --text-main: #f8fafc;
    /* brighter base */
    --text-secondary: #d5deea;
    /* brighter paragraph */
    --text-muted: #a9b7cc;
    /* readable muted */

    /* Reusable emphasis */
    --text-important: #ffffff;
    --text-key: #fbbf24;
    --text-key-2: #4ade80;

    /* Brand */
    --primary: #818cf8;
    --primary-dim: rgba(129, 140, 248, 0.12);
    --primary-glow: rgba(129, 140, 248, 0.25);

    /* Semantic */
    --success: #34d399;
    --danger: #f87171;
    --warning: #fbbf24;
    --safe: #4ade80;
    --gold: #fcd34d;
    --cyan: #67e8f9;

    /* Structure */
    --border: rgba(255, 255, 255, 0.06);
    --border-hover: rgba(255, 255, 255, 0.12);

    /* Aliases used by older pages */
    --border-light: var(--border);
    --glass-border: var(--border);
    --glass-bg: rgba(255, 255, 255, 0.03);
    --radius-sm: 8px;
    --radius-md: 12px;
    --radius-lg: 16px;
    --radius-xl: 24px;

    /* Shadows */
    --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.3);
    --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.3);
    --shadow-lg: 0 8px 30px rgba(0, 0, 0, 0.4);

    /* Reading mode (focus view) */
    --read-max-width: 980px;
    --read-font-size: 1.05rem;
    --read-line-height: 1.85;

    /* Typography tokens */
    --font-sans: 'Inter', ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
    --font-mono: 'JetBrains Mono', ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace;
    --text-base: 1rem;
    --text-sm: 0.9rem;
    --text-xs: 0.78rem;
    --leading: 1.65;

    /* User adjustable typography */
    --ui-font-scale: 1;
    /* 0.9 - 1.15 */
    --ui-reading-max-width: 980px;
    /* slider can tune */
    --ui-code-scale: 1;
    /* 0.85 - 1.15 */

    /* Motion + accessibility */
    --ui-motion: 1;
    /* 0 = reduced motion */
    --focus-ring: 0 0 0 3px color-mix(in srgb, var(--primary) 35%, transparent);

    /* Code panel (VS Code-ish surfaces) */
    --code-panel-bg: var(--bg-card);
    --code-panel-header-bg: color-mix(in srgb, var(--bg-card) 70%, #0b0f1a);
    --code-panel-border: color-mix(in srgb, var(--border) 70%, rgba(255, 255, 255, 0.10));
    --code-panel-title: var(--text-muted);
    --code-panel-btn-bg: rgba(255, 255, 255, 0.08);
    --code-panel-btn-bg-hover: rgba(255, 255, 255, 0.14);
    --code-panel-btn-text: var(--text-muted);
    --code-panel-btn-text-hover: var(--text-main);
    --code-panel-ln: color-mix(in srgb, var(--text-muted) 55%, transparent);

    /* Game tokens (used by game.html) */
    --game-accent: #f472b6;
    --game-accent-2: #ec4899;
    --game-panel-bg: var(--bg-glass);
    --game-panel-border: var(--glass-border);
    --game-soft: rgba(255, 255, 255, 0.04);
    --game-soft-2: rgba(255, 255, 255, 0.08);
}

/* ================================================
   USER SETTINGS (applied via <html data-*> attrs)
   ================================================ */

html[data-motion="reduce"] {
    --ui-motion: 0;
}

html[data-font-scale="sm"] {
    --ui-font-scale: 0.94;
}

html[data-font-scale="md"] {
    --ui-font-scale: 1;
}

html[data-font-scale="lg"] {
    --ui-font-scale: 1.08;
}

html[data-font-scale="xl"] {
    --ui-font-scale: 1.15;
}

html[data-code-scale="sm"] {
    --ui-code-scale: 0.9;
}

html[data-code-scale="md"] {
    --ui-code-scale: 1;
}

html[data-code-scale="lg"] {
    --ui-code-scale: 1.1;
}

html[data-reading-width="narrow"] {
    --ui-reading-max-width: 860px;
}

html[data-reading-width="normal"] {
    --ui-reading-max-width: 980px;
}

html[data-reading-width="wide"] {
    --ui-reading-max-width: 1120px;
}

html[data-code-wrap="on"] pre code.hljs {
    white-space: pre-wrap;
    word-break: break-word;
}

html[data-code-wrap="off"] pre code.hljs {
    white-space: pre;
}

/* ================================================
   THEMES (data-theme on <html>)
   Default tokens above = dark
   ================================================ */

/* Light: clean, readable */
html[data-theme="light"] {
    --bg-dark: #f6f7fb;
    --bg-surface: #ffffff;
    --bg-card: #ffffff;
    --bg-elevated: #f0f3f9;
    --bg-glass: rgba(255, 255, 255, 0.75);

    --text-main: #0b1220;
    --text-secondary: #334155;
    --text-muted: #64748b;

    --text-important: #0b1220;
    --text-key: #b45309;
    --text-key-2: #15803d;

    --primary: #4f46e5;
    --primary-dim: rgba(79, 70, 229, 0.10);
    --primary-glow: rgba(79, 70, 229, 0.18);

    --success: #16a34a;
    --danger: #dc2626;
    --warning: #d97706;
    --safe: #16a34a;
    --gold: #d97706;
    --cyan: #0891b2;

    --border: rgba(2, 6, 23, 0.08);
    --border-hover: rgba(2, 6, 23, 0.14);

    --border-light: var(--border);
    --glass-border: var(--border);
    --glass-bg: rgba(2, 6, 23, 0.03);

    --shadow-sm: 0 1px 2px rgba(2, 6, 23, 0.06);
    --shadow-md: 0 4px 18px rgba(2, 6, 23, 0.10);
    --shadow-lg: 0 10px 40px rgba(2, 6, 23, 0.12);
}

/* Warm Paper (Safari Books / Kindle) */
html[data-theme="paper"] {
    --bg-dark: #fbf7ef;
    --bg-surface: #fffaf2;
    --bg-card: rgba(255, 255, 255, 0.72);
    --bg-elevated: rgba(255, 255, 255, 0.92);
    --bg-glass: rgba(255, 250, 242, 0.78);

    --text-main: #1a1410;
    --text-secondary: #3a2f26;
    --text-muted: #6b5b4b;

    --text-important: #120d0a;
    --text-key: #8a5a00;
    --text-key-2: #1f6f3f;

    /* keep brand but warmer */
    --primary: #7c5cff;
    --primary-dim: rgba(124, 92, 255, 0.10);
    --primary-glow: rgba(124, 92, 255, 0.18);

    --success: #1f7a45;
    --danger: #b42318;
    --warning: #b25e00;
    --safe: #1f7a45;
    --gold: #b25e00;
    --cyan: #0b7285;

    --border: rgba(26, 20, 16, 0.10);
    --border-hover: rgba(26, 20, 16, 0.18);

    --border-light: var(--border);
    --glass-border: var(--border);
    --glass-bg: rgba(26, 20, 16, 0.03);

    --shadow-sm: 0 1px 2px rgba(26, 20, 16, 0.06);
    --shadow-md: 0 8px 30px rgba(26, 20, 16, 0.10);
    --shadow-lg: 0 18px 60px rgba(26, 20, 16, 0.12);

    --code-bg: rgba(26, 20, 16, 0.05);
    --code-border: rgba(26, 20, 16, 0.10);
    --code-text: #2c241d;

    --code-panel-header-bg: rgba(26, 20, 16, 0.06);
    --code-panel-border: rgba(26, 20, 16, 0.14);
    --code-panel-btn-bg: rgba(26, 20, 16, 0.06);
    --code-panel-btn-bg-hover: rgba(26, 20, 16, 0.10);
    --code-panel-btn-text: var(--text-muted);
    --code-panel-btn-text-hover: var(--text-main);
    --code-panel-ln: rgba(26, 20, 16, 0.35);

    --game-accent: #b42318;
    --game-accent-2: #8a5a00;
    --game-panel-bg: rgba(255, 250, 242, 0.72);
    --game-panel-border: rgba(26, 20, 16, 0.14);
    --game-soft: rgba(26, 20, 16, 0.04);
    --game-soft-2: rgba(26, 20, 16, 0.08);
}

/* OLED Dark (true black, high contrast) */
html[data-theme="oled"] {
    --bg-dark: #000000;
    --bg-surface: #05060a;
    --bg-card: #090b12;
    --bg-elevated: #0e111a;
    --bg-glass: rgba(9, 11, 18, 0.78);

    --text-main: #ffffff;
    --text-secondary: #e6eaf2;
    --text-muted: #a8b1c4;

    /* keep brand blue */
    --primary: #7aa2ff;
    --primary-dim: rgba(122, 162, 255, 0.14);
    --primary-glow: rgba(122, 162, 255, 0.26);

    --border: rgba(255, 255, 255, 0.08);
    --border-hover: rgba(255, 255, 255, 0.14);

    --border-light: var(--border);
    --glass-border: var(--border);
    --glass-bg: rgba(255, 255, 255, 0.04);

    --code-bg: rgba(255, 255, 255, 0.06);
    --code-border: rgba(255, 255, 255, 0.10);
    --code-text: var(--text-secondary);

    --code-panel-header-bg: rgba(255, 255, 255, 0.04);
    --code-panel-border: rgba(255, 255, 255, 0.10);
    --code-panel-btn-bg: rgba(255, 255, 255, 0.06);
    --code-panel-btn-bg-hover: rgba(255, 255, 255, 0.12);
    --code-panel-btn-text: var(--text-muted);
    --code-panel-btn-text-hover: var(--text-main);
    --code-panel-ln: rgba(255, 255, 255, 0.32);

    --game-accent: #f472b6;
    --game-accent-2: #ec4899;
    --game-panel-bg: rgba(9, 11, 18, 0.78);
    --game-panel-border: rgba(255, 255, 255, 0.10);
    --game-soft: rgba(255, 255, 255, 0.04);
    --game-soft-2: rgba(255, 255, 255, 0.08);
}

/* Apple Dark: slightly warmer, glassy */
html[data-theme="apple-dark"] {
    /* Apple-ish dark: neutral graphite surfaces + iOS accent blue */
    --bg-dark: #050507;
    --bg-surface: #0b0b0f;
    --bg-card: rgba(255, 255, 255, 0.055);
    --bg-elevated: rgba(255, 255, 255, 0.075);
    --bg-glass: rgba(10, 10, 14, 0.70);

    /* crisp whites (less dull) */
    --text-main: #ffffff;
    --text-secondary: rgba(255, 255, 255, 0.88);
    --text-muted: rgba(255, 255, 255, 0.68);

    /* iOS systemBlue */
    --primary: #0a84ff;
    --primary-dim: rgba(10, 132, 255, 0.18);
    --primary-glow: rgba(10, 132, 255, 0.34);

    --border: rgba(255, 255, 255, 0.10);
    --border-hover: rgba(255, 255, 255, 0.18);

    --border-light: var(--border);
    --glass-border: rgba(255, 255, 255, 0.12);
    --glass-bg: rgba(255, 255, 255, 0.05);
}

/* Graphite: neutral modern (less purple) */
html[data-theme="graphite"] {
    --bg-dark: #0a0f14;
    --bg-surface: #0f1720;
    --bg-card: #111b26;
    --bg-elevated: #162233;
    --bg-glass: rgba(17, 27, 38, 0.82);

    --text-main: #e5e7eb;
    --text-secondary: #cbd5e1;
    --text-muted: #94a3b8;

    --primary: #38bdf8;
    --primary-dim: rgba(56, 189, 248, 0.12);
    --primary-glow: rgba(56, 189, 248, 0.22);

    --success: #34d399;
    --danger: #fb7185;
    --warning: #fbbf24;
    --cyan: #22d3ee;

    --border: rgba(255, 255, 255, 0.06);
    --border-hover: rgba(255, 255, 255, 0.12);

    --border-light: var(--border);
    --glass-border: var(--border);
    --glass-bg: rgba(255, 255, 255, 0.03);
}

/* ================================================
   ACE — Cyber-Minimalist Dark
   Deep obsidian surfaces · cyan/coral/mint/amber accents
   Syne headings · JetBrains Mono body
   ================================================ */
html[data-theme="ace"] {
    /* Surface Colors — Deep Obsidian palette */
    --bg-dark: #0a0a0f;
    --bg-surface: #111118;
    --bg-card: #111118;
    --bg-elevated: #16161f;
    --bg-glass: rgba(10, 10, 15, 0.85);

    /* Text — high contrast on obsidian */
    --text-main: #f0f0f5;
    --text-secondary: #c8c8d8;
    --text-muted: #6b6b80;

    --text-important: #ffffff;
    --text-key: #ffcc00;
    /* Amber highlights */
    --text-key-2: #69ff8e;
    /* Mint emphasis */

    /* Brand — Cyan primary */
    --primary: #00e5ff;
    --primary-dim: rgba(0, 229, 255, 0.10);
    --primary-glow: rgba(0, 229, 255, 0.22);

    /* Semantic */
    --success: #69ff8e;
    /* Mint */
    --danger: #ff6b6b;
    /* Coral */
    --warning: #ffcc00;
    /* Amber */
    --safe: #69ff8e;
    --gold: #ffcc00;
    --cyan: #00e5ff;

    /* Structure */
    --border: rgba(255, 255, 255, 0.06);
    --border-hover: rgba(255, 255, 255, 0.12);

    --border-light: var(--border);
    --glass-border: rgba(255, 255, 255, 0.06);
    --glass-bg: rgba(255, 255, 255, 0.03);

    --radius-sm: 8px;
    --radius-md: 12px;
    --radius-lg: 16px;
    --radius-xl: 24px;

    /* Shadows — deep, inky */
    --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.5);
    --shadow-md: 0 4px 16px rgba(0, 0, 0, 0.45);
    --shadow-lg: 0 8px 40px rgba(0, 0, 0, 0.55);

    /* Typography — Syne for headings, JetBrains Mono for body */
    --font-sans: 'Syne', 'JetBrains Mono', monospace;
    --font-mono: 'JetBrains Mono', ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;

    /* Code panel (dark surfaces) */
    --code-bg: rgba(0, 229, 255, 0.04);
    --code-border: rgba(0, 229, 255, 0.08);
    --code-text: #c8c8d8;

    --code-panel-bg: #111118;
    --code-panel-header-bg: #0d0d14;
    --code-panel-border: rgba(0, 229, 255, 0.08);
    --code-panel-title: #6b6b80;
    --code-panel-btn-bg: rgba(0, 229, 255, 0.08);
    --code-panel-btn-bg-hover: rgba(0, 229, 255, 0.15);
    --code-panel-btn-text: #6b6b80;
    --code-panel-btn-text-hover: #00e5ff;
    --code-panel-ln: rgba(0, 229, 255, 0.25);

    /* Game tokens */
    --game-accent: #00e5ff;
    --game-accent-2: #ff6b6b;
    --game-panel-bg: rgba(10, 10, 15, 0.85);
    --game-panel-border: rgba(255, 255, 255, 0.06);
    --game-soft: rgba(255, 255, 255, 0.04);
    --game-soft-2: rgba(255, 255, 255, 0.08);
}

/* Code surface (used by flashcard/revision etc.) */
:root {
    --code-bg: rgba(0, 0, 0, 0.35);
    --code-border: var(--border);
    --code-text: var(--text-secondary);
}

html[data-theme="light"] {
    --code-bg: rgba(2, 6, 23, 0.04);
    --code-border: rgba(2, 6, 23, 0.08);
    --code-text: var(--text-secondary);
}

/* Extra sharp mode (optional toggle) */
body.sharp-text {
    --text-main: #ffffff;
    --text-secondary: #e5edf8;
    --text-muted: #c3d0e4;
}

/* ---- Reset & Base ---- */
*,
*::before,
*::after {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

* {
    font-family: var(--font-sans);
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    scrollbar-width: thin;
    scrollbar-color: rgba(255, 255, 255, 0.1) transparent;
}

html {
    font-size: calc(16px * var(--ui-font-scale));
}

::-webkit-scrollbar {
    width: 6px;
    height: 6px;
}

::-webkit-scrollbar-track {
    background: transparent;
}

::-webkit-scrollbar-thumb {
    background: rgba(255, 255, 255, 0.1);
    border-radius: 3px;
}

::-webkit-scrollbar-thumb:hover {
    background: rgba(255, 255, 255, 0.2);
}

::selection {
    background: rgba(129, 140, 248, 0.3);
    color: var(--text-main);
}

html[data-theme="ace"] ::selection {
    background: rgba(0, 229, 255, 0.3);
    color: #ffffff;
}

body {
    background: var(--bg-dark);
    color: var(--text-main);
    font-size: var(--text-base);
    line-height: var(--leading);
    background-image:
        radial-gradient(ellipse at 50% 0%, rgba(129, 140, 248, 0.06) 0%, transparent 50%);
    background-attachment: fixed;
    scroll-behavior: smooth;
}

/* Softer background glow in non-default themes */
html[data-theme="light"] body,
html[data-theme="graphite"] body,
html[data-theme="apple-dark"] body {
    background-image:
        radial-gradient(ellipse at 50% 0%, var(--primary-dim) 0%, transparent 55%);
}

html[data-theme="ace"] body {
    background-image:
        radial-gradient(ellipse at 50% 0%, rgba(0, 229, 255, 0.06) 0%, transparent 50%);
}

html[data-theme="paper"] body {
    background-image:
        radial-gradient(ellipse at 50% 0%, rgba(124, 92, 255, 0.08) 0%, transparent 60%);
}

html[data-theme="oled"] body {
    background-image: none;
}

/* Better mobile notch handling */
@supports (padding: max(0px)) {
    body {
        padding-left: max(0px, env(safe-area-inset-left));
        padding-right: max(0px, env(safe-area-inset-right));
    }
}

/* ================================================
   READING MODE (Focus View)
   Toggle via body.reading-mode
   ================================================ */
body.reading-mode {
    /* slightly warmer text in reading mode */
    --text-secondary: color-mix(in srgb, var(--text-main) 82%, var(--text-muted));
    --text-muted: color-mix(in srgb, var(--text-main) 55%, var(--bg-dark));
}

/* When reading-mode is ON, increase contrast for book-like feel */
body.reading-mode {
    --read-font-size: 1.08rem;
}

/* Light theme reading: Safari Books vibe */
html[data-theme="light"] body.reading-mode {
    --bg-dark: #fbfbfd;
    --text-main: #0a0f1a;
    --text-secondary: #1f2937;
    --text-muted: #4b5563;
}

/* Dark theme reading: brighter paragraphs */
html:not([data-theme]),
html[data-theme="dark"],
html[data-theme="apple-dark"],
html[data-theme="graphite"],
html[data-theme="ace"] {
    color-scheme: dark;
}

body.reading-mode .pro-content,
body.reading-mode .insight-text,
body.reading-mode .dryrun-text,
body.reading-mode .trap-content,
body.reading-mode .collapsible-inner {
    color: var(--text-secondary);
}

/* Constrain main column in focus view */
body.reading-mode .focus-main {
    max-width: var(--ui-reading-max-width);
}

/* Hide sidebar for distraction-free reading */
body.reading-mode .focus-sidebar {
    display: none;
}

body.reading-mode .focus-layout {
    grid-template-columns: 1fr;
    gap: 0;
}

/* Improve long-form text rhythm */
body.reading-mode .pro-content,
body.reading-mode .insight-text,
body.reading-mode .dryrun-text,
body.reading-mode .trap-content,
body.reading-mode .collapsible-inner {
    font-size: var(--read-font-size);
    line-height: var(--read-line-height);
}

/* Better paragraph spacing in focus view */
.pro-content p+p {
    margin-top: 0.9rem;
}

/* Make inline code more readable */
.pro-content code,
.insight-text code,
.dryrun-text code,
.trap-content code {
    line-height: 1.45;
    border: 1px solid rgba(255, 255, 255, 0.06);
}

/* Strong text should pop but not glow */
.pro-content strong,
.insight-text strong,
.dryrun-text strong,
.trap-content strong {
    color: var(--text-main);
    font-weight: 800;
}

/* ---- Typography ---- */
h1,
h2,
h3,
h4,
h5,
h6 {
    color: var(--text-main);
    font-weight: 700;
    line-height: 1.3;
    margin-bottom: 0.75rem;
    letter-spacing: -0.02em;
}

p {
    color: var(--text-secondary);
    margin-bottom: 0.75rem;
}

/* ================================================
   REUSABLE TEXT EMPHASIS (use in HTML snippets too)
   ================================================ */
.important {
    color: var(--text-important);
    font-weight: 800;
}

.key {
    color: var(--text-key);
    font-weight: 800;
}

.key2 {
    color: var(--text-key-2);
    font-weight: 800;
}

.muted {
    color: var(--text-muted);
}

a {
    text-decoration: none;
    transition: all 0.15s ease;
}

ul {
    list-style: none;
}

:focus-visible {
    outline: 2px solid var(--primary);
    outline-offset: 2px;
    border-radius: 4px;
    box-shadow: var(--focus-ring);
}

/* Reduce motion - global */
@media (prefers-reduced-motion: reduce) {
    html {
        --ui-motion: 0;
    }
}

html[data-motion="reduce"] *,
html[data-motion="reduce"] *::before,
html[data-motion="reduce"] *::after {
    transition-duration: 0.001ms !important;
    animation-duration: 0.001ms !important;
    animation-iteration-count: 1 !important;
    scroll-behavior: auto !important;
}

/* ---- Layout ---- */
.container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 24px 48px;
}

/* ================================================
   NAVBAR
   ================================================ */
.navbar,
.nav-bar {
    background: rgba(11, 15, 26, 0.88);
    backdrop-filter: blur(28px) saturate(1.5);
    -webkit-backdrop-filter: blur(28px) saturate(1.5);
    border-bottom: 1px solid rgba(129, 140, 248, 0.08);
    padding: 0;
    position: sticky;
    top: 0;
    z-index: 1000;
    box-shadow: 0 1px 24px rgba(0, 0, 0, 0.35), 0 0 0 1px rgba(255, 255, 255, 0.03) inset;
}

html[data-theme="light"] .navbar,
html[data-theme="light"] .nav-bar {
    background: rgba(246, 247, 251, 0.82);
    border-bottom: 1px solid rgba(2, 6, 23, 0.08);
    box-shadow: 0 1px 20px rgba(2, 6, 23, 0.08), 0 0 0 1px rgba(255, 255, 255, 0.6) inset;
}

html[data-theme="paper"] .navbar,
html[data-theme="paper"] .nav-bar {
    background: rgba(251, 247, 239, 0.88);
    border-bottom: 1px solid rgba(26, 20, 16, 0.10);
    box-shadow: 0 1px 20px rgba(26, 20, 16, 0.10), 0 0 0 1px rgba(255, 255, 255, 0.55) inset;
}

html[data-theme="oled"] .navbar,
html[data-theme="oled"] .nav-bar {
    background: rgba(0, 0, 0, 0.82);
    border-bottom: 1px solid rgba(255, 255, 255, 0.10);
    box-shadow: 0 1px 22px rgba(0, 0, 0, 0.65), 0 0 0 1px rgba(255, 255, 255, 0.04) inset;
}

html[data-theme="ace"] .navbar,
html[data-theme="ace"] .nav-bar {
    background: rgba(10, 10, 15, 0.85);
    backdrop-filter: blur(20px) saturate(1.4);
    -webkit-backdrop-filter: blur(20px) saturate(1.4);
    border-bottom: 1px solid rgba(255, 255, 255, 0.06);
    box-shadow: 0 1px 24px rgba(0, 0, 0, 0.55), 0 0 0 1px rgba(0, 229, 255, 0.04) inset;
}

.nav-content {
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 48px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    height: 58px;
}

.nav-bar>div,
.navbar>div {
    display: flex;
    justify-content: space-between;
    align-items: center;
    width: 100%;
}

.nav-logo {
    font-weight: 800;
    font-size: 1.15rem;
    color: var(--text-main) !important;
    display: flex;
    align-items: center;
    gap: 9px;
    letter-spacing: -0.03em;
    text-decoration: none;
    transition: all 0.25s ease;
    flex-shrink: 0;
}

.nav-logo:hover {
    opacity: 0.9;
    transform: translateY(-1px);
}

.nav-logo i {
    color: var(--primary) !important;
    font-size: 1.1rem;
    filter: drop-shadow(0 0 6px rgba(129, 140, 248, 0.4));
    transition: filter 0.3s;
}

.nav-logo:hover i {
    filter: drop-shadow(0 0 10px rgba(129, 140, 248, 0.6));
}

.nav-links {
    display: flex;
    gap: 4px;
    align-items: center;
    height: 100%;
}

.nav-link,
.nav-bar a:not(.nav-logo):not(.back-btn),
.navbar a:not(.nav-logo):not(.back-btn) {
    text-decoration: none;
    color: var(--text-muted) !important;
    font-weight: 500;
    font-size: 0.83rem;
    padding: 7px 14px;
    border-radius: 8px;
    transition: all 0.2s ease;
    position: relative;
    display: inline-flex;
    align-items: center;
    gap: 6px;
    white-space: nowrap;
}

.nav-link:hover,
.nav-bar a:hover:not(.nav-logo):not(.back-btn),
.navbar a:hover:not(.nav-logo):not(.back-btn) {
    color: var(--text-main) !important;
    background: rgba(255, 255, 255, 0.06);
    transform: translateY(-1px);
}

.nav-link.active {
    color: #fff !important;
    background: rgba(129, 140, 248, 0.12);
    font-weight: 600;
    box-shadow: 0 0 12px rgba(129, 140, 248, 0.1), inset 0 0 0 1px rgba(129, 140, 248, 0.15);
}

.nav-link.active::after {
    content: '';
    position: absolute;
    bottom: -1px;
    left: 50%;
    transform: translateX(-50%);
    width: 60%;
    height: 2px;
    background: linear-gradient(90deg, transparent, var(--primary), transparent);
    border-radius: 2px;
}

/* Revision link accent */
.nav-link.revision-link {
    color: #a78bfa !important;
}

.nav-link.revision-link:hover {
    color: #c4b5fd !important;
    background: rgba(139, 92, 246, 0.1);
}

.nav-link.revision-link.active {
    color: #c4b5fd !important;
    background: rgba(139, 92, 246, 0.15);
    box-shadow: 0 0 12px rgba(139, 92, 246, 0.1), inset 0 0 0 1px rgba(139, 92, 246, 0.2);
}

/* Game button */
.game-btn {
    color: #f472b6 !important;
    display: inline-flex;
    align-items: center;
    gap: 6px;
}

.game-btn:hover {
    color: #f9a8d4 !important;
    background: rgba(244, 114, 182, 0.1) !important;
}

.game-btn.active {
    color: #f9a8d4 !important;
    background: rgba(244, 114, 182, 0.15) !important;
    box-shadow: 0 0 12px rgba(244, 114, 182, 0.1), inset 0 0 0 1px rgba(244, 114, 182, 0.2);
}

/* Theme toggle */
#theme-toggle.nav-link {
    width: 36px;
    height: 36px;
    padding: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 10px;
    transition: all 0.25s ease;
}

#theme-toggle.nav-link:hover {
    background: rgba(255, 255, 255, 0.08);
    transform: rotate(15deg) translateY(-1px);
}

/* Nav separator between main links and special buttons */
.nav-separator {
    width: 1px;
    height: 20px;
    background: rgba(255, 255, 255, 0.08);
    margin: 0 6px;
    flex-shrink: 0;
}

/* ---- Mobile Hamburger ---- */
.nav-hamburger {
    display: none;
    background: transparent;
    border: none;
    color: var(--text-main);
    font-size: 1.25rem;
    cursor: pointer;
    padding: 8px;
    border-radius: 8px;
    transition: all 0.2s ease;
    line-height: 1;
}

.nav-hamburger:hover {
    background: rgba(255, 255, 255, 0.06);
}

.nav-hamburger .fa-times {
    display: none;
}

.nav-hamburger.open .fa-bars {
    display: none;
}

.nav-hamburger.open .fa-times {
    display: inline;
}

/* Game XP Header (below navbar on game.html) */
.game-xp-header {
    background: rgba(11, 15, 26, 0.92);
    border-bottom: 1px solid rgba(129, 140, 248, 0.06);
    padding: 8px 0;
}

.game-xp-header .nav-content {
    display: flex;
    align-items: center;
    gap: 16px;
    height: auto;
}

/* ================================================
   BUTTONS
   ================================================ */
.btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    padding: 10px 20px;
    border-radius: var(--radius-md);
    font-weight: 600;
    font-size: 0.9rem;
    cursor: pointer;
    border: none;
    transition: all 0.15s ease;
}

.btn-primary {
    background: var(--primary);
    color: white;
    box-shadow: 0 2px 8px rgba(129, 140, 248, 0.25);
}

.btn-primary:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 16px rgba(129, 140, 248, 0.35);
}

.back-btn {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    text-decoration: none;
    color: var(--text-secondary);
    font-weight: 500;
    font-size: 0.9rem;
    cursor: pointer;
    padding: 8px 14px;
    background: transparent;
    border-radius: var(--radius-sm);
    border: 1px solid var(--border);
    transition: all 0.15s;
}

.back-btn:hover {
    color: var(--text-main);
    border-color: var(--border-hover);
    background: rgba(255, 255, 255, 0.03);
}

/* ================================================
   HERO SECTION (Dashboard)
   ================================================ */
.hero {
    text-align: center;
    padding: 48px 0 32px;
    margin-bottom: 0;
    position: relative;
    overflow: hidden;
}

.hero-glow {
    position: absolute;
    top: -80px;
    left: 50%;
    transform: translateX(-50%);
    width: 600px;
    height: 300px;
    background: radial-gradient(ellipse, rgba(129, 140, 248, 0.12) 0%, transparent 70%);
    pointer-events: none;
    animation: hero-pulse 6s ease-in-out infinite;
}

@keyframes hero-pulse {

    0%,
    100% {
        opacity: 0.6;
        transform: translateX(-50%) scale(1);
    }

    50% {
        opacity: 1;
        transform: translateX(-50%) scale(1.15);
    }
}

.hero h1 {
    font-size: 3rem;
    font-weight: 800;
    letter-spacing: -0.03em;
    margin-bottom: 12px;
    background: linear-gradient(135deg, #fff 0%, #c4b5fd 50%, #818cf8 100%);
    -webkit-background-clip: text;
    background-clip: text;
    -webkit-text-fill-color: transparent;
    position: relative;
}

.hero p {
    color: var(--text-muted);
    font-size: 1.05rem;
    max-width: 500px;
    margin: 0 auto;
    position: relative;
}

.hero-actions {
    display: flex;
    gap: 12px;
    justify-content: center;
    margin-top: 24px;
    position: relative;
}

.hero-btn {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 10px 24px;
    border-radius: 10px;
    font-size: 0.9rem;
    font-weight: 600;
    text-decoration: none;
    transition: all 0.2s ease;
}

.hero-btn.primary {
    background: linear-gradient(135deg, #6366f1, #818cf8);
    color: #fff;
    box-shadow: 0 4px 15px rgba(99, 102, 241, 0.3);
}

.hero-btn.primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 25px rgba(99, 102, 241, 0.45);
}

.hero-btn.secondary {
    background: rgba(255, 255, 255, 0.05);
    color: var(--text-secondary);
    border: 1px solid var(--border);
}

.hero-btn.secondary:hover {
    background: rgba(255, 255, 255, 0.08);
    border-color: var(--border-hover);
    transform: translateY(-2px);
}

/* ---- Progress Stats Strip ---- */
.progress-strip {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0;
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: var(--radius-lg);
    padding: 16px 32px;
    margin: 8px 0 28px;
}

.progress-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 2px;
    padding: 0 28px;
}

.progress-number {
    font-size: 1.6rem;
    font-weight: 800;
    letter-spacing: -0.02em;
}

.progress-label {
    font-size: 0.75rem;
    color: var(--text-muted);
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

.progress-divider {
    width: 1px;
    height: 36px;
    background: var(--border);
}

.stats-badge {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    background: var(--primary-dim);
    color: var(--primary);
    padding: 5px 14px;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 600;
    margin-bottom: 16px;
    border: 1px solid rgba(129, 140, 248, 0.15);
    position: relative;
}

.stats-badge i {
    font-size: 0.7rem;
}

/* ---- Card Icon Badges ---- */
.card-icon-badge {
    width: 40px;
    height: 40px;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1rem;
    margin-bottom: 12px;
    transition: transform 0.2s ease;
}

.card:hover .card-icon-badge {
    transform: scale(1.1);
}

/* ================================================
   DASHBOARD GRID & CARDS
   ================================================ */
.dashboard-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
    gap: 24px;
    margin-bottom: 40px;
    align-items: stretch;
}

.card,
.stat-card,
.pattern-card,
.question-card,
.mode-card {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: var(--radius-lg);
    padding: 24px;
    display: flex;
    flex-direction: column;
    height: 100%;
    position: relative;
    transition: border-color 0.2s, box-shadow 0.2s;
}

/* Remove the ::before gradient line - keep it clean */
.card::before,
.stat-card::before,
.mode-card::before {
    display: none;
}

.card:hover,
.mode-card:hover {
    border-color: var(--border-hover);
    box-shadow: var(--shadow-md);
}

.card h2 {
    font-size: 1.15rem;
    font-weight: 700;
    margin-bottom: 6px;
    display: flex;
    align-items: center;
    gap: 10px;
}

.card h2 i {
    color: var(--primary);
    font-size: 1rem;
}

.card:hover h2 i {
    transform: none;
    text-shadow: none;
}

.card-desc,
.card>p {
    font-size: 0.88rem;
    color: var(--text-muted);
    margin-bottom: 16px;
    line-height: 1.5;
}

/* Push links grid to bottom */
.link-list-single,
.link-grid,
.tile-tags {
    margin-top: auto;
}

/* ---- Link Grid inside cards ---- */
.link-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 8px;
    margin-top: 16px;
}

/* ---- Q-Links ---- */
.q-link {
    text-decoration: none;
    color: var(--text-secondary);
    background: rgba(255, 255, 255, 0.02);
    border: 1px solid var(--border);
    padding: 10px 14px;
    border-radius: var(--radius-sm);
    font-size: 0.85rem;
    font-weight: 500;
    display: flex;
    align-items: center;
    gap: 10px;
    transition: all 0.15s ease;
}

.q-link:hover {
    background: var(--primary-dim);
    color: var(--text-main);
    border-color: rgba(129, 140, 248, 0.2);
}

.q-link i {
    font-size: 0.9rem;
    width: 20px;
    text-align: center;
    color: var(--primary);
    opacity: 0.7;
}

.q-link:hover i {
    opacity: 1;
    transform: none;
    text-shadow: none;
}

/* Q-Link Themes */
.q-link.theme-success {
    border-color: rgba(52, 211, 153, 0.1);
}

.q-link.theme-success:hover {
    background: rgba(52, 211, 153, 0.08);
    border-color: rgba(52, 211, 153, 0.25);
}

.q-link.theme-success i {
    color: var(--success);
}

.q-link.theme-accent {
    border-color: rgba(244, 114, 182, 0.1);
}

.q-link.theme-accent:hover {
    background: rgba(244, 114, 182, 0.08);
    border-color: rgba(244, 114, 182, 0.25);
}

.q-link.theme-accent i {
    color: #f472b6;
}

.q-link.theme-warning i {
    color: var(--warning);
}

.q-link.theme-danger i {
    color: var(--danger);
}

.q-link.theme-purple {
    border-color: rgba(192, 38, 211, 0.1);
}

.q-link.theme-purple:hover {
    background: rgba(192, 38, 211, 0.08);
    border-color: rgba(192, 38, 211, 0.25);
}

.q-link.theme-purple i {
    color: #c026d3;
}

.q-link.theme-indigo {
    border-color: rgba(99, 102, 241, 0.1);
}

.q-link.theme-indigo:hover {
    background: rgba(99, 102, 241, 0.08);
    border-color: rgba(99, 102, 241, 0.25);
}

.q-link.theme-indigo i {
    color: #6366f1;
}

/* ================================================
   BADGES & TAGS
   ================================================ */
.badge,
.difficulty-badge,
.tile-badge,
.tag,
.tile-tag {
    display: inline-flex;
    align-items: center;
    padding: 2px 8px;
    border-radius: 4px;
    font-size: 0.65rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.badge-must,
.must-do,
.must {
    background: rgba(248, 113, 113, 0.1);
    color: #fca5a5;
    border: 1px solid rgba(248, 113, 113, 0.15);
}

.badge-good,
.good-do,
.good {
    background: rgba(251, 191, 36, 0.1);
    color: #fcd34d;
    border: 1px solid rgba(251, 191, 36, 0.15);
}

.badge-bonus,
.bonus {
    background: rgba(52, 211, 153, 0.1);
    color: #6ee7b7;
    border: 1px solid rgba(52, 211, 153, 0.15);
}

.tag-default,
.tile-tag {
    background: rgba(255, 255, 255, 0.03);
    color: var(--text-muted);
    border: 1px solid var(--border);
    font-size: 0.6rem;
    padding: 2px 7px;
}

/* ================================================
   LEARN PAGE - QUESTION TILES GRID
   ================================================ */
.pattern-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 16px;
    margin-top: 16px;
}

.questions-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 16px;
    margin-top: 20px;
}

/* ---- Question Tile ---- */
.question-tile {
    /* Match dashboard card language (clean + modern) */
    /* Slightly lifted surface so it doesn't merge with bg */
    /* Deep purple/blue surface (separate from background) */
    background: linear-gradient(180deg,
            color-mix(in srgb, var(--bg-card) 84%, #1b0b2a 16%) 0%,
            color-mix(in srgb, var(--bg-card) 86%, #0b2a4a 14%) 100%);
    border: 1px solid color-mix(in srgb, var(--border) 68%, rgba(129, 140, 248, 0.18));
    border-radius: var(--radius-lg);
    padding: 20px;
    cursor: pointer;
    display: flex;
    flex-direction: column;
    gap: 10px;
    height: 100%;
    position: relative;
    transition: all 0.2s ease;
    box-shadow: 0 8px 26px rgba(0, 0, 0, 0.22);
}

.question-tile::before {
    display: none;
}

.question-tile:hover {
    border-color: color-mix(in srgb, var(--primary) 16%, var(--border-hover));
    box-shadow: 0 14px 40px rgba(0, 0, 0, 0.32);
    background: linear-gradient(180deg,
            color-mix(in srgb, var(--bg-elevated) 78%, #1b0b2a 22%) 0%,
            color-mix(in srgb, var(--bg-elevated) 80%, #0b2a4a 20%) 100%);
    transform: translateY(-2px);
}

/* Light theme: keep clean white cards */
html[data-theme="light"] .question-tile {
    background: #ffffff;
    border-color: rgba(2, 6, 23, 0.08);
    box-shadow: 0 10px 30px rgba(2, 6, 23, 0.08);
}

html[data-theme="light"] .question-tile:hover {
    background: #ffffff;
    border-color: rgba(79, 70, 229, 0.22);
    box-shadow: 0 14px 44px rgba(2, 6, 23, 0.10);
}

.question-tile:active {
    transform: translateY(0px);
}

/* Priority indicator - clean left accent */
.question-tile.must {
    border-left: 3px solid transparent;
    box-shadow: 0 0 0 1px rgba(248, 113, 113, 0.0);
}

.question-tile.good {
    border-left: 3px solid transparent;
}

.question-tile.bonus {
    border-left: 3px solid transparent;
}

.question-tile .tile-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.tile-icon {
    display: inline-block;
    font-size: 0.95rem;
    color: var(--text-muted);
}

.tile-right {
    display: inline-flex;
    align-items: center;
    gap: 10px;
    color: var(--text-muted);
}

.tile-arrow {
    font-size: 1.05rem;
    opacity: 0.65;
    transform: translateX(0);
    transition: transform 0.18s ease, opacity 0.18s ease;
}

.question-tile:hover .tile-arrow {
    opacity: 0.95;
    transform: translateX(3px);
}

.tile-subtitle {
    font-size: 0.82rem;
    margin-top: -2px;
    line-height: 1.35;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.tile-title {
    font-weight: 600;
    font-size: 0.95rem;
    color: var(--text-main);
    line-height: 1.4;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

.tile-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 5px;
    margin-top: auto;
}

/* Priority hover glow */
.question-tile.must:hover {
    border-left-color: var(--danger);
}

.question-tile.good:hover {
    border-left-color: var(--warning);
}

.question-tile.bonus:hover {
    border-left-color: var(--safe);
}

/* Tile header: badge on left, optional icon on right */
.question-tile .tile-header {
    align-items: center;
}

.tile-badge {
    border-radius: 999px;
    padding: 4px 10px;
    backdrop-filter: blur(16px) saturate(1.2);
    -webkit-backdrop-filter: blur(16px) saturate(1.2);
}

.tile-title {
    font-size: 1.02rem;
    letter-spacing: -0.01em;
}

.tile-meta {
    opacity: 0.9;
}

.tile-complexity {
    padding: 4px 8px;
    border-radius: 999px;
    border: 1px solid var(--border);
    background: rgba(255, 255, 255, 0.03);
}

html[data-theme="light"] .tile-complexity {
    background: rgba(2, 6, 23, 0.03);
}

.tile-tags {
    gap: 6px;
}

.tile-tag {
    border-radius: 999px;
    padding: 3px 10px;
    background: rgba(255, 255, 255, 0.03);
    border-color: var(--border);
}

/* Tiny glass highlight */
/* Removed glass highlight for dashboard-style consistency */

/* ================================================
   FILTER BAR
   ================================================ */
.filter-bar {
    display: flex;
    justify-content: flex-start;
    gap: 8px;
    margin: 16px 0 0 0;
    flex-wrap: wrap;
}

.filter-btn {
    padding: 6px 14px;
    border-radius: 6px;
    border: 1px solid var(--border);
    background: transparent;
    color: var(--text-muted);
    font-size: 0.8rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.15s;
}

.filter-btn:hover {
    color: var(--text-main);
    border-color: var(--border-hover);
    background: rgba(255, 255, 255, 0.03);
}

.filter-btn.active {
    background: var(--primary);
    color: white;
    border-color: var(--primary);
}

.filter-btn.active.must {
    background: var(--danger);
    border-color: var(--danger);
}

.filter-btn.active.good {
    background: var(--warning);
    border-color: var(--warning);
    color: #000;
}

.filter-btn.active.bonus {
    background: var(--safe);
    border-color: var(--safe);
    color: #000;
}

/* ================================================
   GUIDE TABS
   ================================================ */
.guide-tabs {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    justify-content: center;
    margin-bottom: 20px;
}

.guide-tab {
    padding: 10px 18px;
    border-radius: var(--radius-sm);
    border: 1px solid var(--border);
    cursor: pointer;
    font-weight: 600;
    font-size: 0.9rem;
    transition: all 0.15s;
    background: transparent;
    color: var(--text-muted);
}

.guide-tab:hover {
    background: rgba(255, 255, 255, 0.04);
    color: var(--text-main);
    border-color: var(--border-hover);
}

/* ================================================
   PROGRESS BAR
   ================================================ */
.topic-progress {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: var(--radius-md);
    padding: 14px 18px;
    margin: 16px 0 0 0;
}

.progress-text {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
    font-size: 0.85rem;
    color: var(--text-muted);
    font-weight: 600;
}

.progress-count {
    color: var(--primary);
    font-weight: 700;
}

.progress-track {
    height: 6px;
    background: rgba(255, 255, 255, 0.06);
    border-radius: 6px;
    overflow: hidden;
}

.progress-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--primary), #a78bfa);
    border-radius: 6px;
    transition: width 0.5s ease;
    position: relative;
}

.progress-fill::after {
    content: '';
    position: absolute;
    inset: 0;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
    animation: shimmer 2.5s infinite;
}

@keyframes shimmer {
    0% {
        transform: translateX(-100%);
    }

    100% {
        transform: translateX(100%);
    }
}

/* ================================================
   COLLAPSIBLE SECTIONS
   ================================================ */
.collapsible-section {
    margin-top: 20px;
    border: 1px solid var(--border);
    border-radius: var(--radius-md);
    overflow: hidden;
    background: var(--bg-card);
    transition: border-color 0.2s;
}

.collapsible-section:hover {
    border-color: var(--border-hover);
}

.collapsible-header {
    padding: 16px 20px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: space-between;
    background: transparent;
    user-select: none;
    transition: background 0.15s;
}

.collapsible-header:hover {
    background: rgba(255, 255, 255, 0.02);
}

.collapsible-header-left {
    display: flex;
    align-items: center;
    gap: 10px;
}

.collapsible-header-icon {
    font-size: 1.1rem;
}

.collapsible-header-title {
    font-weight: 600;
    font-size: 0.9rem;
    color: var(--text-main);
}

.collapsible-arrow {
    color: var(--text-muted);
    font-size: 0.8rem;
    transition: transform 0.2s ease;
}

.collapsible-section.open .collapsible-arrow {
    transform: rotate(180deg);
}

.collapsible-content {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.3s ease-out;
}

.collapsible-inner {
    padding: 20px;
    border-top: 1px solid var(--border);
    color: var(--text-secondary);
    font-size: 1rem;
    line-height: 1.7;
}

/* Collapsible section type accents */
.collapsible-section.crux {
    border-left: 3px solid var(--primary);
}

.collapsible-section.crux .collapsible-header-icon {
    color: var(--primary);
}

.collapsible-section.trap {
    border-left: 3px solid var(--danger);
}

.collapsible-section.trap .collapsible-header-icon {
    color: var(--danger);
}

.collapsible-section.dryrun {
    border-left: 3px solid var(--warning);
}

.collapsible-section.dryrun .collapsible-header-icon {
    color: var(--warning);
}

.collapsible-section.visual {
    border-left: 3px solid var(--cyan);
}

.collapsible-section.visual .collapsible-header-icon {
    color: var(--cyan);
}

.collapsible-section.mentalmodel {
    border-left: 3px solid #a78bfa;
}

.collapsible-section.mentalmodel .collapsible-header-icon {
    color: #a78bfa;
}

.collapsible-section.quick-algo {
    border-left: 3px solid var(--primary);
}

/* ================================================
   FOCUS VIEW (Question Detail)
   ================================================ */
.focus-view {
    display: none;
    width: 100%;
    max-width: 1400px;
    margin: 0 auto;
    animation: fadeIn 0.3s ease-out;
    padding-bottom: 80px;
}

.focus-view,
#focus-view-container {
    max-width: 1400px !important;
    width: 100% !important;
    border: none !important;
    box-shadow: none !important;
    background: transparent !important;
    margin: 0 auto !important;
    padding: 0 32px !important;
}

/* Make focus view padding adaptive (helps tablet/phone) */
@media (max-width: 1100px) {
    #focus-view-container {
        padding-left: 18px !important;
        padding-right: 18px !important;
    }
}

@media (max-width: 600px) {
    #focus-view-container {
        padding-left: 12px !important;
        padding-right: 12px !important;
    }
}

/* Code panels: smaller font on phone, still readable */
@media (max-width: 600px) {
    .code-panel-title {
        margin-left: 28px;
        font-size: 0.8rem;
    }

    .code-panel pre code.hljs,
    pre code.hljs {
        padding: 14px !important;
        font-size: 0.8rem;
        line-height: 1.6;
    }
}

.container.focus-active {
    max-width: 100% !important;
    padding: 0 !important;
}

/* ================================================
   PRO SHEET ELEMENTS (Detail View)
   ================================================ */
.hero-card {
    background: transparent;
    border: none;
    padding: 0;
    margin-bottom: 32px;
    box-shadow: none;
    backdrop-filter: none;
}

.hero-card::before {
    display: none;
}

.hero-title {
    font-size: 1.3rem;
    font-weight: 700;
    margin-bottom: 16px;
    display: flex;
    align-items: center;
    gap: 10px;
    color: var(--text-main);
}

.insight-bar {
    display: flex;
    flex-direction: column;
    gap: 16px;
    margin-bottom: 24px;
}

.insight-card {
    background: transparent;
    border: none;
    padding: 0;
    display: flex;
    flex-direction: column;
    justify-content: center;
    border-left: 3px solid var(--primary);
    padding-left: 16px;
}

.insight-label {
    text-transform: uppercase;
    font-size: 0.8rem;
    font-weight: 700;
    color: var(--primary);
    margin-bottom: 6px;
    letter-spacing: 0.5px;
}

.insight-text {
    font-size: 1.05rem;
    line-height: 1.5;
    color: var(--text-main);
    font-weight: 500;
}

.metric-stack {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.metric-box {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: var(--radius-md);
    padding: 12px 14px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.metric-value {
    font-family: var(--font-mono);
    font-weight: 700;
    color: var(--cyan);
}

.pro-section {
    margin: 24px 0;
}

.pro-header {
    font-size: 1.1rem;
    font-weight: 700;
    margin-bottom: 14px;
    display: flex;
    align-items: center;
    gap: 10px;
    color: var(--text-main);
    border-bottom: 1px solid var(--border);
    padding-bottom: 12px;
}

.pro-content {
    font-size: 1rem;
    line-height: 1.7;
    color: var(--text-secondary);
}

/* ================================================
   SKIP TO PRACTICE
   ================================================ */
.skip-to-practice-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    background: var(--primary);
    color: white;
    padding: 14px 20px;
    border-radius: var(--radius-md);
    font-weight: 600;
    text-decoration: none;
    margin: 16px 0 24px;
    transition: all 0.15s ease;
    font-size: 0.9rem;
}

.skip-to-practice-btn:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 16px rgba(129, 140, 248, 0.3);
}

.skip-to-practice-btn i {
    font-size: 1rem;
}

/* ================================================
   SYSTEM DESIGN / CUSTOM CONTENT
   ================================================ */
.diagram {
    font-family: var(--font-mono);
    white-space: pre;
    background: var(--bg-surface);
    color: var(--text-secondary);
    padding: 16px;
    border-radius: var(--radius-sm);
    overflow-x: auto;
    font-size: 13px;
    line-height: 1.3;
    border: 1px solid var(--border);
}

/* ================================================
   Theme menu (injected by script.js)
   ================================================ */
.theme-menu {
    position: absolute;
    right: 16px;
    top: 70px;
    min-width: 190px;
    background: var(--bg-glass);
    border: 1px solid var(--border);
    border-radius: 14px;
    box-shadow: var(--shadow-lg);
    backdrop-filter: blur(18px) saturate(1.4);
    -webkit-backdrop-filter: blur(18px) saturate(1.4);
    padding: 10px;
    display: none;
    z-index: 3000;
}

.theme-menu.open {
    display: block;
    animation: fadeIn 0.16s ease-out;
}

.theme-menu-title {
    font-size: 0.7rem;
    font-weight: 800;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: var(--text-muted);
    padding: 8px 10px 10px;
}

.theme-option {
    width: 100%;
    border: 1px solid transparent;
    background: transparent;
    color: var(--text-secondary);
    padding: 10px 10px;
    border-radius: 12px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 12px;
    transition: all 0.15s ease;
    font-size: 0.86rem;
}

.theme-option-left {
    display: inline-flex;
    align-items: center;
    gap: 10px;
}

.theme-option i {
    width: 18px;
    text-align: center;
    color: var(--primary);
}

.theme-option:hover {
    background: rgba(255, 255, 255, 0.06);
    border-color: var(--border);
    color: var(--text-main);
}

.theme-option.active {
    background: var(--primary-dim);
    border-color: rgba(129, 140, 248, 0.18);
    color: var(--text-main);
}

.theme-check {
    opacity: 0;
    color: var(--text-main);
    font-weight: 900;
}

.theme-option.active .theme-check {
    opacity: 1;
}

/* Light theme needs darker hover overlays */
html[data-theme="light"] .theme-option:hover {
    background: rgba(2, 6, 23, 0.04);
}

html[data-theme="light"] .theme-option.active {
    background: rgba(79, 70, 229, 0.10);
    border-color: rgba(79, 70, 229, 0.16);
}

.highlight {
    background: rgba(251, 191, 36, 0.15);
    padding: 1px 4px;
    border-radius: 3px;
    border-bottom: 2px solid var(--warning);
}

.trap-box {
    background: rgba(248, 113, 113, 0.06) !important;
    border-left: 4px solid var(--danger) !important;
    padding: 14px;
    margin: 14px 0;
    border-radius: 0 var(--radius-sm) var(--radius-sm) 0;
    color: var(--text-main) !important;
}

.tag-math {
    background-color: #8e44ad;
}

.tag-logic {
    background-color: var(--success);
}

.tag-trap {
    background-color: var(--danger);
}

.tag-pro {
    background-color: var(--warning);
    color: #000;
}

.custom-sys-design-body h3 {
    color: var(--text-secondary);
    margin-top: 20px;
    border-bottom: 1px solid var(--border);
    padding-bottom: 8px;
}

.custom-sys-design-body table {
    width: 100%;
    border-collapse: collapse;
    margin: 12px 0;
    font-size: 0.9rem;
}

.custom-sys-design-body th,
.custom-sys-design-body td {
    border: 1px solid var(--border);
    padding: 10px;
    text-align: left;
}

.custom-sys-design-body th {
    background: var(--bg-elevated);
    color: var(--primary);
}

/* ================================================
   ANIMATIONS
   ================================================ */
@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(8px);
    }

    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.fade-in {
    animation: fadeIn 0.4s ease-out;
}

/* ================================================
   RESPONSIVE
   ================================================ */
@media (max-width: 768px) {
    .container {
        padding: 16px 20px;
    }

    .nav-content {
        padding: 0 20px;
        height: 54px;
    }

    .nav-hamburger {
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .nav-links {
        display: none;
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        background: rgba(11, 15, 26, 0.96);
        backdrop-filter: blur(24px) saturate(1.5);
        -webkit-backdrop-filter: blur(24px) saturate(1.5);
        border-bottom: 1px solid rgba(129, 140, 248, 0.08);
        box-shadow: 0 12px 32px rgba(0, 0, 0, 0.4);
        padding: 12px 20px 16px;
        flex-direction: column;
        gap: 4px;
        z-index: 999;
        animation: navSlideDown 0.25s ease-out;
    }

    @keyframes navSlideDown {
        from {
            opacity: 0;
            transform: translateY(-8px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .nav-links.open {
        display: flex;
    }

    .nav-links .nav-link {
        width: 100%;
        padding: 10px 16px;
        border-radius: 10px;
        font-size: 0.88rem;
    }

    .nav-links .nav-separator {
        width: 100%;
        height: 1px;
        margin: 4px 0;
    }

    .nav-links #theme-toggle.nav-link {
        width: 100%;
        height: auto;
        padding: 10px 16px;
        justify-content: flex-start;
        gap: 8px;
    }

    .dashboard-grid {
        grid-template-columns: 1fr;
    }

    .link-grid {
        grid-template-columns: 1fr;
    }

    .hero h1 {
        font-size: 2rem;
    }

    .hero-actions {
        flex-direction: column;
        align-items: center;
    }

    .progress-strip {
        flex-wrap: wrap;
        padding: 12px 16px;
        gap: 8px;
    }

    .progress-item {
        padding: 0 16px;
    }

    .progress-divider {
        height: 24px;
    }

    .insight-bar {
        flex-direction: column;
    }

    .hero h1 {
        font-size: 2rem;
    }

    .questions-grid {
        grid-template-columns: 1fr;
    }
}

@media (max-width: 1024px) {
    .questions-grid {
        grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
    }
}

/* ================================================
   SETTINGS PANEL (injected by script.js)
   ================================================ */
.settings-fab {
    position: fixed;
    right: 16px;
    bottom: calc(16px + env(safe-area-inset-bottom));
    z-index: 2600;
    width: 44px;
    height: 44px;
    border-radius: 14px;
    background: var(--bg-glass);
    border: 1px solid var(--border);
    color: var(--text-main);
    display: inline-flex;
    align-items: center;
    justify-content: center;
    backdrop-filter: blur(18px) saturate(1.4);
    -webkit-backdrop-filter: blur(18px) saturate(1.4);
    box-shadow: var(--shadow-lg);
    cursor: pointer;
    transition: transform 0.15s ease, background 0.15s ease;
}

.settings-fab:hover {
    transform: translateY(-2px);
    background: color-mix(in srgb, var(--bg-glass) 85%, var(--primary-dim));
}

.settings-panel {
    position: fixed;
    right: 16px;
    bottom: calc(70px + env(safe-area-inset-bottom));
    width: min(360px, calc(100vw - 32px));
    background: var(--bg-glass);
    border: 1px solid var(--border);
    border-radius: 16px;
    box-shadow: var(--shadow-lg);
    backdrop-filter: blur(18px) saturate(1.4);
    -webkit-backdrop-filter: blur(18px) saturate(1.4);
    padding: 12px;
    z-index: 2600;
    display: none;
}

.settings-panel.open {
    display: block;
    animation: fadeIn 0.14s ease-out;
}

.settings-title {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 10px;
    padding: 8px 10px 10px;
}

.settings-title h4 {
    margin: 0;
    font-size: 0.9rem;
    letter-spacing: -0.01em;
}

.settings-close {
    background: transparent;
    border: 1px solid transparent;
    color: var(--text-muted);
    border-radius: 10px;
    padding: 6px 10px;
    cursor: pointer;
}

.settings-close:hover {
    background: rgba(255, 255, 255, 0.06);
    color: var(--text-main);
    border-color: var(--border);
}

.setting-group {
    border-top: 1px solid var(--border);
    padding: 10px;
}

.setting-label {
    font-size: 0.72rem;
    font-weight: 800;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: var(--text-muted);
    margin-bottom: 8px;
}

.pill-row {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
}

.pill {
    border: 1px solid var(--border);
    background: rgba(255, 255, 255, 0.03);
    color: var(--text-secondary);
    padding: 8px 10px;
    border-radius: 999px;
    font-size: 0.82rem;
    cursor: pointer;
    transition: background 0.15s ease, border-color 0.15s ease, color 0.15s ease;
}

.pill:hover {
    border-color: var(--border-hover);
    color: var(--text-main);
}

.pill.active {
    background: var(--primary-dim);
    border-color: color-mix(in srgb, var(--primary) 30%, var(--border));
    color: var(--text-main);
}

/* ================================================
   ACE THEME — Visual Layers & Overrides
   Noise texture · Atmospheric glow · Syne headings
   ================================================ */

/* Noise texture overlay (ace only) */
html[data-theme="ace"] body::after {
    content: '';
    position: fixed;
    inset: 0;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.04'/%3E%3C/svg%3E");
    pointer-events: none;
    z-index: 1000;
    opacity: 0.4;
}

/* Heading typography — Syne 800, tight tracking */
html[data-theme="ace"] h1,
html[data-theme="ace"] h2,
html[data-theme="ace"] h3,
html[data-theme="ace"] h4,
html[data-theme="ace"] h5,
html[data-theme="ace"] h6 {
    font-family: 'Syne', sans-serif;
    font-weight: 800;
    letter-spacing: -0.04em;
}

/* Body text — JetBrains Mono 300/400, generous leading */
html[data-theme="ace"] body {
    font-family: 'JetBrains Mono', monospace;
    font-weight: 300;
    line-height: 1.8;
}

/* Labels — ALL CAPS, wide tracking, muted */
html[data-theme="ace"] .setting-label,
html[data-theme="ace"] .theme-menu-title {
    text-transform: uppercase;
    letter-spacing: 4px;
    font-size: 10px;
    color: #6b6b80;
    font-weight: 400;
}

/* Active nav link — cyan accent */
html[data-theme="ace"] .nav-link.active {
    color: #00e5ff !important;
    background: rgba(0, 229, 255, 0.10);
    box-shadow: 0 0 12px rgba(0, 229, 255, 0.08), inset 0 0 0 1px rgba(0, 229, 255, 0.12);
}

html[data-theme="ace"] .nav-link.active::after {
    background: linear-gradient(90deg, transparent, #00e5ff, transparent);
}

/* Revision link — coral accent in ace */
html[data-theme="ace"] .nav-link.revision-link {
    color: #ff6b6b !important;
}

html[data-theme="ace"] .nav-link.revision-link:hover {
    color: #ff8a8a !important;
    background: rgba(255, 107, 107, 0.08);
}

html[data-theme="ace"] .nav-link.revision-link.active {
    color: #ff8a8a !important;
    background: rgba(255, 107, 107, 0.12);
    box-shadow: 0 0 12px rgba(255, 107, 107, 0.08), inset 0 0 0 1px rgba(255, 107, 107, 0.15);
}

/* Game button — amber in ace */
html[data-theme="ace"] .game-btn {
    color: #ffcc00 !important;
}

html[data-theme="ace"] .game-btn:hover {
    color: #ffe066 !important;
    background: rgba(255, 204, 0, 0.08) !important;
}

/* Logo glow — cyan */
html[data-theme="ace"] .nav-logo i {
    color: #00e5ff !important;
    filter: drop-shadow(0 0 6px rgba(0, 229, 255, 0.45));
}

html[data-theme="ace"] .nav-logo:hover i {
    filter: drop-shadow(0 0 12px rgba(0, 229, 255, 0.65));
}

/* Scrollbar — thin 4px */
html[data-theme="ace"] ::-webkit-scrollbar {
    width: 4px;
    height: 4px;
}

html[data-theme="ace"] ::-webkit-scrollbar-thumb {
    background: rgba(0, 229, 255, 0.15);
    border-radius: 2px;
}

html[data-theme="ace"] ::-webkit-scrollbar-thumb:hover {
    background: rgba(0, 229, 255, 0.3);
}

/* Focus ring — cyan */
html[data-theme="ace"] :focus-visible {
    outline: 2px solid #00e5ff;
    box-shadow: 0 0 0 3px rgba(0, 229, 255, 0.2);
}