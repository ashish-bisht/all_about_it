<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üî§ LCS - Interactive Visualization</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --bg: #0f172a;
            --card-bg: #1e293b;
            --text-main: #f1f5f9;
            --text-muted: #94a3b8;
            --primary: #8b5cf6;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --accent: #22d3ee;
            --border: #334155;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Inter', -apple-system, sans-serif;
            background: var(--bg);
            color: var(--text-main);
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        /* Hero */
        .hero {
            text-align: center;
            padding: 50px 20px;
            background: linear-gradient(135deg, #06b6d4, #22d3ee, #67e8f9);
            border-radius: 20px;
            margin-bottom: 30px;
        }

        .hero h1 {
            font-size: 3rem;
            font-weight: 900;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            color: #0c4a6e;
        }

        .hero p {
            font-size: 1.3rem;
            opacity: 0.95;
            color: #0c4a6e;
        }

        /* Controls */
        .controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }

        .btn:hover {
            background: #7c3aed;
            transform: translateY(-2px);
        }

        .btn:disabled {
            background: var(--border);
            cursor: not-allowed;
            transform: none;
        }

        /* Main Grid */
        .main-grid {
            display: grid;
            grid-template-columns: 1.2fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        /* Card */
        .card {
            background: var(--card-bg);
            border-radius: 16px;
            border: 2px solid var(--border);
            padding: 25px;
        }

        .card h2 {
            color: var(--accent);
            margin-bottom: 20px;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Strings Display */
        .strings-container {
            margin: 20px 0;
        }

        .string-row {
            margin-bottom: 30px;
        }

        .string-label {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--accent);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .string-chars {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .char-box {
            width: 60px;
            height: 70px;
            background: rgba(34, 211, 238, 0.1);
            border: 2px solid var(--border);
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: 900;
            transition: all 0.3s;
            position: relative;
        }

        .char-index {
            position: absolute;
            top: 5px;
            right: 5px;
            font-size: 0.7rem;
            color: var(--text-muted);
            background: rgba(0, 0, 0, 0.3);
            padding: 2px 6px;
            border-radius: 4px;
        }

        .char-box.current-s1 {
            background: linear-gradient(135deg, #8b5cf6, #a78bfa);
            border-color: var(--primary);
            color: white;
            transform: scale(1.1);
            box-shadow: 0 8px 20px rgba(139, 92, 246, 0.4);
        }

        .char-box.current-s2 {
            background: linear-gradient(135deg, #f59e0b, #fbbf24);
            border-color: var(--warning);
            color: white;
            transform: scale(1.1);
            box-shadow: 0 8px 20px rgba(245, 158, 11, 0.4);
        }

        .char-box.matched {
            background: linear-gradient(135deg, #10b981, #34d399);
            border-color: var(--success);
            color: white;
            animation: matchPulse 0.6s;
        }

        .char-box.skipped {
            background: rgba(100, 116, 139, 0.2);
            border-color: #475569;
            opacity: 0.4;
        }

        @keyframes matchPulse {

            0%,
            100% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.2) rotate(5deg);
            }
        }

        /* 2D Grid Visualization */
        .grid-container {
            margin: 20px 0;
            overflow-x: auto;
        }

        .dp-grid {
            display: inline-grid;
            gap: 2px;
            background: var(--border);
            padding: 2px;
            border-radius: 8px;
        }

        .grid-cell {
            width: 50px;
            height: 50px;
            background: var(--card-bg);
            border: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.1rem;
            transition: all 0.3s;
        }

        .grid-cell.header {
            background: rgba(34, 211, 238, 0.2);
            color: var(--accent);
            font-size: 0.9rem;
        }

        .grid-cell.current {
            background: var(--primary);
            color: white;
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.4);
            z-index: 10;
        }

        .grid-cell.computed {
            background: rgba(16, 185, 129, 0.3);
            color: var(--success);
        }

        /* Decision Box */
        .decision-box {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.2), rgba(34, 211, 238, 0.2));
            border: 3px solid var(--primary);
            border-radius: 16px;
            padding: 25px;
            margin: 20px 0;
            text-align: center;
        }

        .decision-title {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--accent);
            margin-bottom: 15px;
        }

        .comparison {
            display: flex;
            gap: 15px;
            justify-content: center;
            align-items: center;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .char-compare {
            font-size: 3rem;
            font-weight: 900;
            padding: 20px 30px;
            border-radius: 12px;
            border: 3px solid;
        }

        .char-s1 {
            background: rgba(139, 92, 246, 0.2);
            border-color: var(--primary);
            color: var(--primary);
        }

        .char-s2 {
            background: rgba(245, 158, 11, 0.2);
            border-color: var(--warning);
            color: var(--warning);
        }

        .compare-symbol {
            font-size: 2rem;
            color: var(--text-muted);
        }

        .match-result {
            margin-top: 15px;
            font-size: 1.3rem;
            font-weight: 700;
        }

        .match-result.yes {
            color: var(--success);
        }

        .match-result.no {
            color: var(--danger);
        }

        .decision-options {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 20px;
        }

        .decision-option {
            background: rgba(139, 92, 246, 0.1);
            border: 2px solid var(--border);
            padding: 15px;
            border-radius: 12px;
        }

        .decision-option.winner {
            border-color: var(--success);
            background: rgba(16, 185, 129, 0.2);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
        }

        .option-label {
            font-size: 0.9rem;
            color: var(--text-muted);
            margin-bottom: 8px;
        }

        .option-value {
            font-size: 2rem;
            font-weight: 900;
            color: var(--primary);
        }

        .decision-option.winner .option-value {
            color: var(--success);
        }

        /* LCS Result */
        .lcs-result {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.2), rgba(34, 211, 238, 0.2));
            border: 3px solid var(--success);
            border-radius: 16px;
            padding: 30px;
            text-align: center;
            margin: 20px 0;
        }

        .lcs-length {
            font-size: 4rem;
            font-weight: 900;
            color: var(--success);
            margin-bottom: 10px;
        }

        .lcs-string {
            font-size: 2rem;
            font-weight: 700;
            color: var(--accent);
            font-family: 'Consolas', monospace;
            margin-top: 15px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
        }

        /* Call Stack */
        .call-stack {
            display: flex;
            flex-direction: column;
            gap: 8px;
            max-height: 400px;
            overflow-y: auto;
        }

        .stack-item {
            background: rgba(34, 211, 238, 0.1);
            border: 2px solid var(--border);
            border-left: 4px solid var(--accent);
            padding: 10px;
            border-radius: 8px;
            font-family: 'Consolas', monospace;
            font-size: 0.9rem;
            transition: all 0.3s;
        }

        .stack-item.active {
            background: rgba(34, 211, 238, 0.3);
            border-color: var(--accent);
        }

        .stack-item.success {
            border-left-color: var(--success);
            background: rgba(16, 185, 129, 0.1);
        }

        /* Memo Table */
        .memo-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(90px, 1fr));
            gap: 8px;
        }

        .memo-item {
            background: rgba(34, 211, 238, 0.1);
            border: 2px solid var(--border);
            padding: 10px;
            border-radius: 8px;
            text-align: center;
        }

        .memo-item.hit {
            background: var(--success);
            border-color: var(--success);
            color: white;
            animation: memoHit 0.5s;
        }

        .memo-key {
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        .memo-value {
            font-size: 1.3rem;
            font-weight: 900;
            color: var(--accent);
            margin-top: 5px;
        }

        .memo-item.hit .memo-key,
        .memo-item.hit .memo-value {
            color: white;
        }

        @keyframes memoHit {

            0%,
            100% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.15);
            }
        }

        /* Stats */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(110px, 1fr));
            gap: 12px;
            margin-top: 15px;
        }

        .stat-box {
            background: rgba(34, 211, 238, 0.1);
            border: 2px solid var(--border);
            border-radius: 10px;
            padding: 12px;
            text-align: center;
        }

        .stat-number {
            font-size: 1.8rem;
            font-weight: 900;
            color: var(--accent);
        }

        .stat-label {
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-top: 5px;
        }

        /* Steps Log */
        .steps-log {
            background: var(--card-bg);
            border-radius: 16px;
            border: 2px solid var(--border);
            padding: 25px;
            max-height: 500px;
            overflow-y: auto;
        }

        .step-item {
            padding: 10px;
            border-left: 3px solid var(--border);
            margin-bottom: 8px;
            font-size: 0.9rem;
            border-radius: 4px;
        }

        .step-item.info {
            border-left-color: var(--accent);
            background: rgba(34, 211, 238, 0.05);
        }

        .step-item.success {
            border-left-color: var(--success);
            background: rgba(16, 185, 129, 0.05);
        }

        .step-item.error {
            border-left-color: var(--danger);
            background: rgba(239, 68, 68, 0.05);
        }

        .step-item.warning {
            border-left-color: var(--warning);
            background: rgba(245, 158, 11, 0.05);
        }

        /* Code Display */
        .code-display {
            background: #0d1117;
            border-radius: 12px;
            padding: 20px;
            font-family: 'Consolas', monospace;
            font-size: 0.85rem;
            line-height: 1.8;
            overflow-x: auto;
            border: 2px solid var(--border);
        }

        .code-line {
            display: block;
        }

        .code-line.highlight {
            background: rgba(34, 211, 238, 0.3);
            border-left: 3px solid var(--accent);
            padding-left: 10px;
            margin-left: -10px;
        }

        .keyword {
            color: #ff79c6;
        }

        .function {
            color: #50fa7b;
        }

        .string {
            color: #f1fa8c;
        }

        .comment {
            color: #6272a4;
        }

        .number {
            color: #bd93f9;
        }

        @media (max-width: 1200px) {
            .main-grid {
                grid-template-columns: 1fr;
            }

            .decision-options {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body>

    <div class="container">

        <div class="hero">
            <h1>üî§ Longest Common Subsequence</h1>
            <p>Match/Skip Pattern - 2D DP Visualization</p>
        </div>

        <div class="controls">
            <button class="btn" onclick="startVisualization()">
                <i class="fas fa-play"></i> Start
            </button>
            <button class="btn" onclick="nextStep()" id="nextBtn" disabled>
                <i class="fas fa-step-forward"></i> Next Step
            </button>
            <button class="btn" onclick="autoPlay()" id="autoBtn" disabled>
                <i class="fas fa-forward"></i> Auto Play
            </button>
            <button class="btn" onclick="resetVisualization()">
                <i class="fas fa-redo"></i> Reset
            </button>
        </div>

        <div class="main-grid">
            <!-- Left Column -->
            <div>
                <div class="card">
                    <h2><i class="fas fa-text-width"></i> Input Strings</h2>
                    <div class="strings-container">
                        <div class="string-row">
                            <div class="string-label">
                                <i class="fas fa-arrow-right" style="color: var(--primary);"></i>
                                String 1:
                            </div>
                            <div class="string-chars" id="string1Chars"></div>
                        </div>
                        <div class="string-row">
                            <div class="string-label">
                                <i class="fas fa-arrow-right" style="color: var(--warning);"></i>
                                String 2:
                            </div>
                            <div class="string-chars" id="string2Chars"></div>
                        </div>
                    </div>
                </div>

                <div class="card" style="margin-top: 20px;">
                    <h2><i class="fas fa-balance-scale"></i> Current Comparison</h2>
                    <div class="decision-box" id="decisionBox">
                        <div style="color: var(--text-muted);">Waiting to start...</div>
                    </div>
                </div>

                <div class="card" style="margin-top: 20px;" id="resultCard" style="display: none;">
                    <h2><i class="fas fa-trophy"></i> LCS Found!</h2>
                    <div class="lcs-result" id="lcsResult"></div>
                </div>

                <div class="card" style="margin-top: 20px;">
                    <h2><i class="fas fa-chart-bar"></i> Statistics</h2>
                    <div class="stats-grid">
                        <div class="stat-box">
                            <div class="stat-number" id="statSteps">0</div>
                            <div class="stat-label">Steps</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-number" id="statCalls">0</div>
                            <div class="stat-label">Calls</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-number" id="statHits">0</div>
                            <div class="stat-label">Memo Hits</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-number" id="statMatches">0</div>
                            <div class="stat-label">Matches</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-number" id="statLCS">0</div>
                            <div class="stat-label">LCS Length</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Column -->
            <div>
                <div class="card">
                    <h2><i class="fas fa-table"></i> DP Grid (2D State)</h2>
                    <div class="grid-container" id="gridContainer">
                        <div style="color: var(--text-muted); text-align: center;">Starting...</div>
                    </div>
                </div>

                <div class="card" style="margin-top: 20px;">
                    <h2><i class="fas fa-layer-group"></i> Call Stack</h2>
                    <div class="call-stack" id="callStack">
                        <div style="color: var(--text-muted); text-align: center;">No calls yet...</div>
                    </div>
                </div>

                <div class="card" style="margin-top: 20px;">
                    <h2><i class="fas fa-save"></i> Memoization</h2>
                    <div class="memo-grid" id="memoTable">
                        <div style="color: var(--text-muted); text-align: center;">Empty memo...</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="steps-log">
            <h2 style="color: var(--accent); margin-bottom: 20px;">
                <i class="fas fa-list"></i> Execution Log
            </h2>
            <div id="stepsLog">
                <div style="color: var(--text-muted); text-align: center;">Click "Start" to begin...</div>
            </div>
        </div>

        <div class="card" style="margin-top: 20px;">
            <h2><i class="fas fa-code"></i> Code Being Executed</h2>
            <div class="code-display">
                <span class="code-line"><span class="keyword">def</span> <span class="function">LCS</span>(s1,
                    s2):</span>
                <span class="code-line"> memo = {}</span>
                <span class="code-line"> </span>
                <span class="code-line"> <span class="keyword">def</span> <span class="function">dfs</span>(i,
                    j):</span>
                <span class="code-line" id="line-base"> <span class="comment"># Base case: Ek string
                        khatam</span></span>
                <span class="code-line"> <span class="keyword">if</span> i >= <span class="function">len</span>(s1)
                    <span class="keyword">or</span> j >= <span class="function">len</span>(s2):</span>
                <span class="code-line"> <span class="keyword">return</span> <span class="number">0</span></span>
                <span class="code-line"> </span>
                <span class="code-line" id="line-memo"> <span class="comment"># Memo check</span></span>
                <span class="code-line"> <span class="keyword">if</span> (i, j) <span class="keyword">in</span>
                    memo:</span>
                <span class="code-line"> <span class="keyword">return</span> memo[(i, j)]</span>
                <span class="code-line"> </span>
                <span class="code-line" id="line-match"> <span class="comment"># MATCH: Characters same
                        hain!</span></span>
                <span class="code-line"> <span class="keyword">if</span> s1[i] == s2[j]:</span>
                <span class="code-line"> result = <span class="number">1</span> + <span
                        class="function">dfs</span>(i+<span class="number">1</span>, j+<span
                        class="number">1</span>)</span>
                <span class="code-line"> <span class="keyword">else</span>:</span>
                <span class="code-line" id="line-skip"> <span class="comment"># SKIP: Try skipping from either
                        string</span></span>
                <span class="code-line"> skip_s1 = <span class="function">dfs</span>(i+<span class="number">1</span>, j)
                    <span class="comment"># Skip from string 1</span></span>
                <span class="code-line"> skip_s2 = <span class="function">dfs</span>(i, j+<span class="number">1</span>)
                    <span class="comment"># Skip from string 2</span></span>
                <span class="code-line"> result = <span class="function">max</span>(skip_s1, skip_s2)</span>
                <span class="code-line"> </span>
                <span class="code-line" id="line-save"> memo[(i, j)] = result</span>
                <span class="code-line"> <span class="keyword">return</span> result</span>
                <span class="code-line"> </span>
                <span class="code-line"> <span class="keyword">return</span> <span class="function">dfs</span>(<span
                        class="number">0</span>, <span class="number">0</span>)</span>
            </div>
        </div>

    </div>

    <script>
        // Configuration
        const s1 = "ABCDGH";
        const s2 = "AEDFHR";

        // State
        let steps = [];
        let currentStep = 0;
        let memo = {};
        let callStack = [];
        let dpGrid = [];
        let stats = {
            steps: 0,
            calls: 0,
            hits: 0,
            matches: 0,
            lcs: 0
        };
        let autoPlayInterval = null;

        // Initialize
        function initialize() {
            // Render strings
            const s1Div = document.getElementById('string1Chars');
            const s2Div = document.getElementById('string2Chars');

            s1Div.innerHTML = '';
            s2Div.innerHTML = '';

            for (let i = 0; i < s1.length; i++) {
                s1Div.innerHTML += `
                <div class="char-box" id="s1-${i}">
                    ${s1[i]}
                    <div class="char-index">${i}</div>
                </div>
            `;
            }

            for (let j = 0; j < s2.length; j++) {
                s2Div.innerHTML += `
                <div class="char-box" id="s2-${j}">
                    ${s2[j]}
                    <div class="char-index">${j}</div>
                </div>
            `;
            }

            initializeGrid();
        }

        function initializeGrid() {
            dpGrid = [];
            for (let i = 0; i <= s1.length; i++) {
                dpGrid[i] = [];
                for (let j = 0; j <= s2.length; j++) {
                    dpGrid[i][j] = '';
                }
            }
            renderGrid();
        }

        function renderGrid() {
            const container = document.getElementById('gridContainer');
            const cols = s2.length + 2;

            let html = `<div class="dp-grid" style="grid-template-columns: repeat(${cols}, 50px);">`;

            // Header row
            html += '<div class="grid-cell header"></div>';
            html += '<div class="grid-cell header">Œµ</div>';
            for (let j = 0; j < s2.length; j++) {
                html += `<div class="grid-cell header">${s2[j]}</div>`;
            }

            // Data rows
            for (let i = 0; i <= s1.length; i++) {
                // Row header
                html += `<div class="grid-cell header">${i === 0 ? 'Œµ' : s1[i - 1]}</div>`;

                for (let j = 0; j <= s2.length; j++) {
                    const value = dpGrid[i][j] !== '' ? dpGrid[i][j] : '';
                    const cellClass = dpGrid[i][j] !== '' ? 'computed' : '';
                    html += `<div class="grid-cell ${cellClass}" id="grid-${i}-${j}">${value}</div>`;
                }
            }

            html += '</div>';
            container.innerHTML = html;
        }

        // Generate steps
        function generateSteps() {
            steps = [];
            memo = {};
            dpGrid = [];
            for (let i = 0; i <= s1.length; i++) {
                dpGrid[i] = [];
                for (let j = 0; j <= s2.length; j++) {
                    dpGrid[i][j] = '';
                }
            }

            function dfs(i, j, depth = 0) {
                steps.push({
                    type: 'call',
                    i: i,
                    j: j,
                    depth: depth,
                    message: `üìû dfs(${i}, ${j}) - Compare: ${i < s1.length ? s1[i] : 'END'} vs ${j < s2.length ? s2[j] : 'END'}`
                });

                if (i >= s1.length || j >= s2.length) {
                    steps.push({
                        type: 'base',
                        i: i,
                        j: j,
                        depth: depth,
                        message: `‚úÖ Base case! ${i >= s1.length ? 'String 1' : 'String 2'} finished. Return 0`
                    });
                    dpGrid[i][j] = 0;
                    return 0;
                }

                const state = `${i},${j}`;
                if (state in memo) {
                    steps.push({
                        type: 'memo-hit',
                        i: i,
                        j: j,
                        value: memo[state],
                        depth: depth,
                        message: `üíæ Memo hit! memo[${i},${j}] = ${memo[state]}`
                    });
                    return memo[state];
                }

                const char1 = s1[i];
                const char2 = s2[j];

                steps.push({
                    type: 'compare',
                    i: i,
                    j: j,
                    char1: char1,
                    char2: char2,
                    match: char1 === char2,
                    depth: depth,
                    message: `üîç Compare: '${char1}' ${char1 === char2 ? '==' : '!='} '${char2}'`
                });

                let result;

                if (char1 === char2) {
                    steps.push({
                        type: 'match',
                        i: i,
                        j: j,
                        char: char1,
                        depth: depth,
                        message: `‚ú® MATCH! '${char1}' == '${char2}'. Include in LCS! Call dfs(${i + 1}, ${j + 1})`
                    });

                    result = 1 + dfs(i + 1, j + 1, depth + 1);

                    steps.push({
                        type: 'match-result',
                        i: i,
                        j: j,
                        result: result,
                        depth: depth,
                        message: `‚úÖ Match result: 1 + ${result - 1} = ${result}`
                    });
                } else {
                    steps.push({
                        type: 'skip-start',
                        i: i,
                        j: j,
                        depth: depth,
                        message: `‚ùå No match. Try skipping from either string...`
                    });

                    steps.push({
                        type: 'skip-s1',
                        i: i,
                        j: j,
                        depth: depth,
                        message: `‚è≠Ô∏è Skip '${char1}' from String 1. Call dfs(${i + 1}, ${j})`
                    });

                    const skipS1 = dfs(i + 1, j, depth + 1);

                    steps.push({
                        type: 'skip-s2',
                        i: i,
                        j: j,
                        depth: depth,
                        message: `‚è≠Ô∏è Skip '${char2}' from String 2. Call dfs(${i}, ${j + 1})`
                    });

                    const skipS2 = dfs(i, j + 1, depth + 1);

                    result = Math.max(skipS1, skipS2);

                    steps.push({
                        type: 'skip-result',
                        i: i,
                        j: j,
                        skipS1: skipS1,
                        skipS2: skipS2,
                        result: result,
                        depth: depth,
                        message: `‚öñÔ∏è max(skip_s1=${skipS1}, skip_s2=${skipS2}) = ${result}`
                    });
                }

                steps.push({
                    type: 'save',
                    i: i,
                    j: j,
                    result: result,
                    depth: depth,
                    message: `üíæ Save: memo[${i},${j}] = ${result}`
                });

                memo[state] = result;
                dpGrid[i][j] = result;
                return result;
            }

            const lcsLength = dfs(0, 0);

            steps.push({
                type: 'final',
                result: lcsLength,
                message: `üèÅ Final LCS Length: ${lcsLength}`
            });
        }

        // Start
        function startVisualization() {
            resetVisualization();
            generateSteps();
            document.getElementById('nextBtn').disabled = false;
            document.getElementById('autoBtn').disabled = false;
            addLog('info', 'üöÄ Visualization started!');
            addLog('info', `String 1: "${s1}"`);
            addLog('info', `String 2: "${s2}"`);
        }

        // Reset
        function resetVisualization() {
            currentStep = 0;
            memo = {};
            callStack = [];
            stats = { steps: 0, calls: 0, hits: 0, matches: 0, lcs: 0 };
            steps = [];

            if (autoPlayInterval) {
                clearInterval(autoPlayInterval);
                autoPlayInterval = null;
            }

            document.getElementById('stepsLog').innerHTML = '';
            document.getElementById('callStack').innerHTML = '<div style="color: var(--text-muted); text-align: center;">No calls yet...</div>';
            document.getElementById('memoTable').innerHTML = '<div style="color: var(--text-muted); text-align: center;">Empty memo...</div>';
            document.getElementById('decisionBox').innerHTML = '<div style="color: var(--text-muted);">Waiting to start...</div>';
            document.getElementById('resultCard').style.display = 'none';
            document.getElementById('nextBtn').disabled = true;
            document.getElementById('autoBtn').disabled = true;

            updateStats();
            initialize();
            clearHighlights();
        }

        // Next step
        function nextStep() {
            if (currentStep >= steps.length) {
                addLog('success', '‚úÖ Visualization complete!');
                document.getElementById('nextBtn').disabled = true;
                document.getElementById('autoBtn').disabled = true;
                return;
            }

            const step = steps[currentStep];
            executeStep(step);
            currentStep++;
            stats.steps++;
            updateStats();

            if (currentStep >= steps.length) {
                document.getElementById('nextBtn').disabled = true;
                document.getElementById('autoBtn').disabled = true;
            }
        }

        // Execute step
        function executeStep(step) {
            clearHighlights();

            switch (step.type) {
                case 'call':
                    highlightLine('line-base');
                    stats.calls++;
                    addLog('info', step.message);
                    highlightChars(step.i, step.j, 'current');
                    updateCallStack(`dfs(${step.i}, ${step.j})`, step.depth, 'active');
                    highlightGridCell(step.i, step.j);
                    break;

                case 'base':
                    highlightLine('line-base');
                    addLog('success', step.message);
                    updateCallStackResult(step.depth, 0);
                    updateGridValue(step.i, step.j, 0);
                    break;

                case 'memo-hit':
                    highlightLine('line-memo');
                    stats.hits++;
                    addLog('success', step.message);
                    highlightMemo(step.i, step.j);
                    updateCallStackResult(step.depth, step.value);
                    break;

                case 'compare':
                    highlightLine('line-match');
                    addLog('info', step.message);
                    highlightChars(step.i, step.j, 'current');
                    showComparison(step.char1, step.char2, step.match);
                    break;

                case 'match':
                    highlightLine('line-match');
                    stats.matches++;
                    addLog('success', step.message);
                    highlightChars(step.i, step.j, 'matched');
                    break;

                case 'match-result':
                    addLog('success', step.message);
                    break;

                case 'skip-start':
                    highlightLine('line-skip');
                    addLog('warning', step.message);
                    break;

                case 'skip-s1':
                    highlightLine('line-skip');
                    addLog('warning', step.message);
                    highlightChars(step.i, null, 'skipped');
                    break;

                case 'skip-s2':
                    highlightLine('line-skip');
                    addLog('warning', step.message);
                    highlightChars(null, step.j, 'skipped');
                    break;

                case 'skip-result':
                    addLog('success', step.message);
                    showSkipDecision(step.skipS1, step.skipS2, step.result);
                    break;

                case 'save':
                    highlightLine('line-save');
                    addLog('success', step.message);
                    updateMemo(step.i, step.j, step.result);
                    updateGridValue(step.i, step.j, step.result);
                    updateCallStackResult(step.depth, step.result);
                    stats.lcs = Math.max(stats.lcs, step.result);
                    break;

                case 'final':
                    addLog('success', step.message);
                    stats.lcs = step.result;
                    showFinalResult(step.result);
                    break;
            }
        }

        // Auto play
        function autoPlay() {
            if (autoPlayInterval) {
                clearInterval(autoPlayInterval);
                autoPlayInterval = null;
                document.getElementById('autoBtn').innerHTML = '<i class="fas fa-forward"></i> Auto Play';
            } else {
                autoPlayInterval = setInterval(() => {
                    if (currentStep >= steps.length) {
                        clearInterval(autoPlayInterval);
                        autoPlayInterval = null;
                        document.getElementById('autoBtn').innerHTML = '<i class="fas fa-forward"></i> Auto Play';
                    } else {
                        nextStep();
                    }
                }, 1000);
                document.getElementById('autoBtn').innerHTML = '<i class="fas fa-pause"></i> Pause';
            }
        }

        // Helper functions
        function highlightChars(i, j, className) {
            if (i !== null && i < s1.length) {
                document.getElementById(`s1-${i}`).classList.add(`${className}-s1`);
            }
            if (j !== null && j < s2.length) {
                document.getElementById(`s2-${j}`).classList.add(`${className}-s2`);
            }
        }

        function showComparison(char1, char2, match) {
            const box = document.getElementById('decisionBox');
            box.innerHTML = `
            <div class="decision-title">Character Comparison</div>
            <div class="comparison">
                <div class="char-compare char-s1">${char1}</div>
                <div class="compare-symbol">${match ? '==' : '!='}</div>
                <div class="char-compare char-s2">${char2}</div>
            </div>
            <div class="match-result ${match ? 'yes' : 'no'}">
                ${match ? '‚úÖ MATCH! Include in LCS' : '‚ùå No Match. Try Skipping'}
            </div>
        `;
        }

        function showSkipDecision(skipS1, skipS2, result) {
            const box = document.getElementById('decisionBox');
            box.innerHTML = `
            <div class="decision-title">Skip Decision</div>
            <div class="decision-options">
                <div class="decision-option ${skipS1 === result ? 'winner' : ''}">
                    <div class="option-label">Skip from S1</div>
                    <div class="option-value">${skipS1}</div>
                </div>
                <div class="decision-option ${skipS2 === result ? 'winner' : ''}">
                    <div class="option-label">Skip from S2</div>
                    <div class="option-value">${skipS2}</div>
                </div>
                <div class="decision-option winner">
                    <div class="option-label">Result (max)</div>
                    <div class="option-value">${result}</div>
                </div>
            </div>
        `;
        }

        function showFinalResult(length) {
            document.getElementById('resultCard').style.display = 'block';
            document.getElementById('lcsResult').innerHTML = `
            <div class="lcs-length">${length}</div>
            <div style="color: var(--text-muted);">Length of LCS</div>
            <div class="lcs-string">"${getLCSString()}"</div>
        `;
        }

        function getLCSString() {
            // Backtrack to find actual LCS
            let i = 0, j = 0;
            let lcs = '';

            while (i < s1.length && j < s2.length) {
                if (s1[i] === s2[j]) {
                    lcs += s1[i];
                    i++;
                    j++;
                } else {
                    const key1 = `${i + 1},${j}`;
                    const key2 = `${i},${j + 1}`;
                    const val1 = memo[key1] || 0;
                    const val2 = memo[key2] || 0;

                    if (val1 >= val2) {
                        i++;
                    } else {
                        j++;
                    }
                }
            }

            return lcs;
        }

        function highlightGridCell(i, j) {
            document.querySelectorAll('.grid-cell.current').forEach(cell => {
                cell.classList.remove('current');
            });

            const cell = document.getElementById(`grid-${i}-${j}`);
            if (cell) cell.classList.add('current');
        }

        function updateGridValue(i, j, value) {
            const cell = document.getElementById(`grid-${i}-${j}`);
            if (cell) {
                cell.textContent = value;
                cell.classList.add('computed');
            }
            renderGrid();
        }

        function updateCallStack(call, depth, status) {
            callStack.push({ call, depth, status });
            renderCallStack();
        }

        function updateCallStackResult(depth, result) {
            for (let i = callStack.length - 1; i >= 0; i--) {
                if (callStack[i].depth === depth) {
                    callStack[i].status = 'success';
                    callStack[i].result = result;
                    break;
                }
            }
            renderCallStack();

            setTimeout(() => {
                for (let i = callStack.length - 1; i >= 0; i--) {
                    if (callStack[i].depth === depth) {
                        callStack.splice(i, 1);
                        break;
                    }
                }
                renderCallStack();
            }, 300);
        }

        function renderCallStack() {
            const stackDiv = document.getElementById('callStack');
            if (callStack.length === 0) {
                stackDiv.innerHTML = '<div style="color: var(--text-muted); text-align: center;">No calls yet...</div>';
                return;
            }

            stackDiv.innerHTML = callStack.map(item => `
            <div class="stack-item ${item.status}">
                ${'  '.repeat(item.depth)}${item.call}${item.result !== undefined ? ' ‚Üí ' + item.result : ''}
            </div>
        `).join('');
        }

        function updateMemo(i, j, value) {
            const key = `${i},${j}`;
            memo[key] = value;
            renderMemo();
        }

        function highlightMemo(i, j) {
            const elem = document.getElementById(`memo-${i}-${j}`);
            if (elem) {
                elem.classList.add('hit');
                setTimeout(() => elem.classList.remove('hit'), 500);
            }
        }

        function renderMemo() {
            const memoDiv = document.getElementById('memoTable');
            const keys = Object.keys(memo).sort((a, b) => {
                const [ai, aj] = a.split(',').map(Number);
                const [bi, bj] = b.split(',').map(Number);
                return ai === bi ? aj - bj : ai - bi;
            });

            if (keys.length === 0) {
                memoDiv.innerHTML = '<div style="color: var(--text-muted); text-align: center;">Empty memo...</div>';
                return;
            }

            memoDiv.innerHTML = keys.map(key => {
                const value = memo[key];
                return `
                <div class="memo-item" id="memo-${key.replace(',', '-')}">
                    <div class="memo-key">(${key})</div>
                    <div class="memo-value">${value}</div>
                </div>
            `;
            }).join('');
        }

        function addLog(type, message) {
            const logDiv = document.getElementById('stepsLog');
            if (logDiv.children.length === 1 && logDiv.children[0].textContent.includes('Click "Start"')) {
                logDiv.innerHTML = '';
            }

            logDiv.innerHTML += `<div class="step-item ${type}">${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function updateStats() {
            document.getElementById('statSteps').textContent = stats.steps;
            document.getElementById('statCalls').textContent = stats.calls;
            document.getElementById('statHits').textContent = stats.hits;
            document.getElementById('statMatches').textContent = stats.matches;
            document.getElementById('statLCS').textContent = stats.lcs;
        }

        function highlightLine(lineId) {
            document.querySelectorAll('.code-line').forEach(line => {
                line.classList.remove('highlight');
            });
            const line = document.getElementById(lineId);
            if (line) line.classList.add('highlight');
        }

        function clearHighlights() {
            document.querySelectorAll('.char-box').forEach(box => {
                box.className = 'char-box';
            });
            document.querySelectorAll('.code-line').forEach(line => {
                line.classList.remove('highlight');
            });
        }

        // Initialize on load
        window.onload = initialize;
    </script>

</body>

</html>